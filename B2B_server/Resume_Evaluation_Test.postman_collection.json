{
	"info": {
		"_postman_id": "resume-evaluation-test-collection",
		"name": "Resume Evaluation API Tests",
		"description": "Comprehensive test collection for /api/resumes/evaluate endpoint covering all test cases from M09.9",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "1. Valid Resume and Job Description",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"const baseUrl = pm.environment.get('base_url');",
							"const email = pm.environment.get('test_email');",
							"const password = pm.environment.get('test_password');",
							"",
							"if (!pm.environment.get('access_token')) {",
							"    pm.sendRequest({",
							"        url: baseUrl + '/api/auth/login',",
							"        method: 'POST',",
							"        header: {",
							"            'Content-Type': 'application/json'",
							"        },",
							"        body: {",
							"            mode: 'raw',",
							"            raw: JSON.stringify({",
							"                email: email,",
							"                password: password",
							"            })",
							"        }",
							"    }, function (err, res) {",
							"        if (err) {",
							"            console.error('Login error:', err);",
							"            return;",
							"        }",
							"        if (res.code === 200) {",
							"            const jsonData = res.json();",
							"            pm.environment.set('access_token', jsonData.data.access_token);",
							"            console.log('Token fetched successfully');",
							"        } else {",
							"            console.error('Login failed:', res.json());",
							"        }",
							"    });",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "formdata",
					"formdata": [
						{
							"key": "file",
							"type": "file",
							"src": [],
							"description": "Upload a valid PDF, DOCX, TXT, or image file"
						},
						{
							"key": "jobDescription",
							"value": "We are looking for a Senior Software Engineer with 5+ years of experience in Node.js, TypeScript, and PostgreSQL. The candidate should have strong problem-solving skills and experience with RESTful APIs.",
							"type": "text"
						},
						{
							"key": "jobName",
							"value": "Senior Software Engineer",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{base_url}}/api/resumes/evaluate",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"resumes",
						"evaluate"
					]
				},
				"description": "Test Case 1: Upload a valid resume file (PDF/DOCX/TXT/image) with a valid job description. Expected: Successful evaluation with parsed data, scores, and suggestions."
			},
			"response": []
		},
		{
			"name": "2. Invalid File Type",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"const baseUrl = pm.environment.get('base_url');",
							"const email = pm.environment.get('test_email');",
							"const password = pm.environment.get('test_password');",
							"",
							"if (!pm.environment.get('access_token')) {",
							"    pm.sendRequest({",
							"        url: baseUrl + '/api/auth/login',",
							"        method: 'POST',",
							"        header: {",
							"            'Content-Type': 'application/json'",
							"        },",
							"        body: {",
							"            mode: 'raw',",
							"            raw: JSON.stringify({",
							"                email: email,",
							"                password: password",
							"            })",
							"        }",
							"    }, function (err, res) {",
							"        if (err) {",
							"            console.error('Login error:', err);",
							"            return;",
							"        }",
							"        if (res.code === 200) {",
							"            const jsonData = res.json();",
							"            pm.environment.set('access_token', jsonData.data.access_token);",
							"            console.log('Token fetched successfully');",
							"        } else {",
							"            console.error('Login failed:', res.json());",
							"        }",
							"    });",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "formdata",
					"formdata": [
						{
							"key": "file",
							"type": "file",
							"src": [],
							"description": "Upload an invalid file type (e.g., .exe, .zip, .mp4)"
						},
						{
							"key": "jobDescription",
							"value": "Test job description",
							"type": "text"
						},
						{
							"key": "jobName",
							"value": "Test Job",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{base_url}}/api/resumes/evaluate",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"resumes",
						"evaluate"
					]
				},
				"description": "Test Case 2: Upload an invalid file type (e.g., executable). Expected: Error response with appropriate error message about invalid file format."
			},
			"response": []
		},
		{
			"name": "3. Oversized File",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"const baseUrl = pm.environment.get('base_url');",
							"const email = pm.environment.get('test_email');",
							"const password = pm.environment.get('test_password');",
							"",
							"if (!pm.environment.get('access_token')) {",
							"    pm.sendRequest({",
							"        url: baseUrl + '/api/auth/login',",
							"        method: 'POST',",
							"        header: {",
							"            'Content-Type': 'application/json'",
							"        },",
							"        body: {",
							"            mode: 'raw',",
							"            raw: JSON.stringify({",
							"                email: email,",
							"                password: password",
							"            })",
							"        }",
							"    }, function (err, res) {",
							"        if (err) {",
							"            console.error('Login error:', err);",
							"            return;",
							"        }",
							"        if (res.code === 200) {",
							"            const jsonData = res.json();",
							"            pm.environment.set('access_token', jsonData.data.access_token);",
							"            console.log('Token fetched successfully');",
							"        } else {",
							"            console.error('Login failed:', res.json());",
							"        }",
							"    });",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "formdata",
					"formdata": [
						{
							"key": "file",
							"type": "file",
							"src": [],
							"description": "Upload a file larger than 10MB (use oversized-test-file.pdf generated by script)"
						},
						{
							"key": "jobDescription",
							"value": "Test job description",
							"type": "text"
						},
						{
							"key": "jobName",
							"value": "Test Job",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{base_url}}/api/resumes/evaluate",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"resumes",
						"evaluate"
					]
				},
				"description": "Test Case 3: Upload a file larger than the allowed size (10MB). Expected: Error response with appropriate error message about file size limit."
			},
			"response": []
		},
		{
			"name": "4. Missing Job Description",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"const baseUrl = pm.environment.get('base_url');",
							"const email = pm.environment.get('test_email');",
							"const password = pm.environment.get('test_password');",
							"",
							"if (!pm.environment.get('access_token')) {",
							"    pm.sendRequest({",
							"        url: baseUrl + '/api/auth/login',",
							"        method: 'POST',",
							"        header: {",
							"            'Content-Type': 'application/json'",
							"        },",
							"        body: {",
							"            mode: 'raw',",
							"            raw: JSON.stringify({",
							"                email: email,",
							"                password: password",
							"            })",
							"        }",
							"    }, function (err, res) {",
							"        if (err) {",
							"            console.error('Login error:', err);",
							"            return;",
							"        }",
							"        if (res.code === 200) {",
							"            const jsonData = res.json();",
							"            pm.environment.set('access_token', jsonData.data.access_token);",
							"            console.log('Token fetched successfully');",
							"        } else {",
							"            console.error('Login failed:', res.json());",
							"        }",
							"    });",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "formdata",
					"formdata": [
						{
							"key": "file",
							"type": "file",
							"src": [],
							"description": "Upload a valid resume file"
						},
						{
							"key": "jobName",
							"value": "Test Job",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{base_url}}/api/resumes/evaluate",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"resumes",
						"evaluate"
					]
				},
				"description": "Test Case 4: Upload a valid file without a job description. Expected: Error response with appropriate error message about missing job description."
			},
			"response": []
		},
		{
			"name": "5. Empty File",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"const baseUrl = pm.environment.get('base_url');",
							"const email = pm.environment.get('test_email');",
							"const password = pm.environment.get('test_password');",
							"",
							"if (!pm.environment.get('access_token')) {",
							"    pm.sendRequest({",
							"        url: baseUrl + '/api/auth/login',",
							"        method: 'POST',",
							"        header: {",
							"            'Content-Type': 'application/json'",
							"        },",
							"        body: {",
							"            mode: 'raw',",
							"            raw: JSON.stringify({",
							"                email: email,",
							"                password: password",
							"            })",
							"        }",
							"    }, function (err, res) {",
							"        if (err) {",
							"            console.error('Login error:', err);",
							"            return;",
							"        }",
							"        if (res.code === 200) {",
							"            const jsonData = res.json();",
							"            pm.environment.set('access_token', jsonData.data.access_token);",
							"            console.log('Token fetched successfully');",
							"        } else {",
							"            console.error('Login failed:', res.json());",
							"        }",
							"    });",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "formdata",
					"formdata": [
						{
							"key": "file",
							"type": "file",
							"src": [],
							"description": "Upload an empty file (0 bytes)"
						},
						{
							"key": "jobDescription",
							"value": "Test job description",
							"type": "text"
						},
						{
							"key": "jobName",
							"value": "Test Job",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{base_url}}/api/resumes/evaluate",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"resumes",
						"evaluate"
					]
				},
				"description": "Test Case 5: Upload an empty file (0 bytes). Expected: Error response with appropriate error message about empty file."
			},
			"response": []
		},
		{
			"name": "6. Valid Job Description with No File",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"const baseUrl = pm.environment.get('base_url');",
							"const email = pm.environment.get('test_email');",
							"const password = pm.environment.get('test_password');",
							"",
							"if (!pm.environment.get('access_token')) {",
							"    pm.sendRequest({",
							"        url: baseUrl + '/api/auth/login',",
							"        method: 'POST',",
							"        header: {",
							"            'Content-Type': 'application/json'",
							"        },",
							"        body: {",
							"            mode: 'raw',",
							"            raw: JSON.stringify({",
							"                email: email,",
							"                password: password",
							"            })",
							"        }",
							"    }, function (err, res) {",
							"        if (err) {",
							"            console.error('Login error:', err);",
							"            return;",
							"        }",
							"        if (res.code === 200) {",
							"            const jsonData = res.json();",
							"            pm.environment.set('access_token', jsonData.data.access_token);",
							"            console.log('Token fetched successfully');",
							"        } else {",
							"            console.error('Login failed:', res.json());",
							"        }",
							"    });",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "formdata",
					"formdata": [
						{
							"key": "jobDescription",
							"value": "We are looking for a Senior Software Engineer with 5+ years of experience.",
							"type": "text"
						},
						{
							"key": "jobName",
							"value": "Senior Software Engineer",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{base_url}}/api/resumes/evaluate",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"resumes",
						"evaluate"
					]
				},
				"description": "Test Case 6: Upload a valid job description without a file. Expected: Error response with appropriate error message about missing file."
			},
			"response": []
		},
		{
			"name": "7. Authentication Failure",
			"request": {
				"method": "POST",
				"header": [],
				"body": {
					"mode": "formdata",
					"formdata": [
						{
							"key": "file",
							"type": "file",
							"src": [],
							"description": "Upload a valid resume file"
						},
						{
							"key": "jobDescription",
							"value": "Test job description",
							"type": "text"
						},
						{
							"key": "jobName",
							"value": "Test Job",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{base_url}}/api/resumes/evaluate",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"resumes",
						"evaluate"
					]
				},
				"description": "Test Case 7: Call the API without proper authentication (no token). Expected: Error response with appropriate error message about missing or invalid token."
			},
			"response": []
		},
		{
			"name": "8. WebSocket Status Updates",
			"event": [
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"const baseUrl = pm.environment.get('base_url');",
							"const email = pm.environment.get('test_email');",
							"const password = pm.environment.get('test_password');",
							"",
							"if (!pm.environment.get('access_token')) {",
							"    pm.sendRequest({",
							"        url: baseUrl + '/api/auth/login',",
							"        method: 'POST',",
							"        header: {",
							"            'Content-Type': 'application/json'",
							"        },",
							"        body: {",
							"            mode: 'raw',",
							"            raw: JSON.stringify({",
							"                email: email,",
							"                password: password",
							"            })",
							"        }",
							"    }, function (err, res) {",
							"        if (err) {",
							"            console.error('Login error:', err);",
							"            return;",
							"        }",
							"        if (res.code === 200) {",
							"            const jsonData = res.json();",
							"            pm.environment.set('access_token', jsonData.data.access_token);",
							"            console.log('Token fetched successfully');",
							"        } else {",
							"            console.error('Login failed:', res.json());",
							"        }",
							"    });",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Authorization",
						"value": "Bearer {{access_token}}",
						"type": "text"
					}
				],
				"body": {
					"mode": "formdata",
					"formdata": [
						{
							"key": "file",
							"type": "file",
							"src": [],
							"description": "Upload a valid resume file. Note: This test requires a WebSocket client to connect to ws://{{base_url}}/api/resumes/status and receive real-time status updates."
						},
						{
							"key": "jobDescription",
							"value": "We are looking for a Senior Software Engineer with 5+ years of experience.",
							"type": "text"
						},
						{
							"key": "jobName",
							"value": "Senior Software Engineer",
							"type": "text"
						}
					]
				},
				"url": {
					"raw": "{{base_url}}/api/resumes/evaluate",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"api",
						"resumes",
						"evaluate"
					]
				},
				"description": "Test Case 8: Connect to WebSocket endpoint and receive status updates during evaluation. Expected: Real-time status updates for each step (upload, parsability_check, ocr, parsing, grading, completed). Note: Use a WebSocket client (e.g., Postman WebSocket, browser console, or separate tool) to connect to ws://{{base_url}}/api/resumes/status with token in query parameter."
			},
			"response": []
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:5000",
			"type": "string"
		}
	]
}

